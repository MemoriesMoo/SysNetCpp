# `shared_ptr` 的思路

## 概述

`shared_ptr` 是 C++ 标准库中的智能指针之一，用于管理共享拥有的对象。它允许多个指针共享相同的资源，通过引用计数来跟踪资源的使用情况。

## 主要特点

1. **共享性**: `shared_ptr` 允许多个指针共享相同的资源，确保资源不会在最后一个拥有者销毁时被释放。

2. **引用计数**: `shared_ptr` 维护一个引用计数，跟踪资源的引用次数，以便在不再需要资源时自动释放。

3. **自动释放**: `shared_ptr` 在不再需要资源时自动释放资源，从而避免资源泄漏。

4. **强制类型安全**: `shared_ptr` 提供类型安全，不需要进行显式的类型转换。

5. **可用于容器**: `shared_ptr` 可以安全地用于STL容器，无需手动管理内存。

## 实现思路

以下是实现 `shared_ptr` 的关键思路：

1. **构造函数**: 提供默认构造函数和接受指向资源的指针的构造函数，以及可能接受自定义的删除器函数。

2. **拷贝构造函数和赋值运算符**: 允许多个 `shared_ptr` 共享相同的资源。当拷贝时，引用计数会增加。

3. **引用计数**: 使用一个引用计数来跟踪资源的引用次数。当新的 `shared_ptr` 指向资源时，引用计数会增加。当 `shared_ptr` 超出作用域或被显式销毁时，引用计数会减少。当引用计数变为0时，资源被释放。

4. **get() 函数**: 提供一个函数，以获取当前共享的资源的指针。

5. **reset() 函数**: 用于释放资源，当最后一个 `shared_ptr` 超出作用域时。

6. **自定义删除器**: 允许提供自定义的删除器函数，以便在释放资源时执行额外的操作。

7. **析构函数**: 当 `shared_ptr` 超出作用域时，析构函数会自动减少引用计数，当引用计数变为0时，资源被释放。

## 使用示例

```cpp
shared_ptr<int> ptr1(new int(42));  // 创建一个shared_ptr，共享一个动态分配的int对象

shared_ptr<int> ptr2 = ptr1;  // 共享相同的资源，引用计数增加

ptr1.reset();  // 释放ptr1的资源，引用计数减少

ptr2.reset();  // 释放ptr2的资源，资源被最后一个拥有者销毁
```

`shared_ptr` 的主要思路是允许多个指针共享相同的资源，并通过引用计数来跟踪资源的使用情况。这样，资源不会在最后一个拥有者销毁时被释放，从而避免资源泄漏。它提供了一种强制类型安全的方式来管理资源生命周期，无需手动管理内存，可安全用于STL容器。